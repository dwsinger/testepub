<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Information technology — MPEG systems technologies — Part 16: Derived visual tracks in the ISO base media file format</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li .secno { font-size: 85%; }
	.toc > li li li li li { font-size:   85%;    }
	.toc > li li li li li .secno { font-size: 100%; }

	/* @supports not (display:grid) { */
		.toc > li             { margin: 1.5rem 0;    }
		.toc > li li          { margin: 0.3rem 0;    }
		.toc > li li li       { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}

		.toc li {
			clear: both;
		}

		:not(li) > .toc              { margin-left:  5rem; }
		.toc .secno                  { margin-left: -5rem; }
		.toc > li li li .secno       { margin-left: -7rem; }
		.toc > li li li li .secno    { margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc              { margin-left:  4rem; }
			.toc .secno                  { margin-left: -4rem; }
			.toc > li li li              { margin-left:  1rem; }
			.toc > li li li .secno       { margin-left: -5rem; }
			.toc > li li li li .secno    { margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			   comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
		}
		#toc .content:hover {
			background: rgba(75%, 75%, 75%, .25);
			border-bottom: 3px solid #054572;
			margin-bottom: -3px;
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good table positioning:
		   "content column" is 50ems wide at max; less on smaller screens.
		   Extra space (after ToC + content) is empty on the right.

		   1. When table < content column, centers table in column.
		   2. When content < table < available, left-aligns.
		   3. When table > available, fills available + scroll bar.
		*/ 
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
<style>
    body { font-family: Cambria, Serif }
    
    @media print {
      .sdl {font-size: 10px}

      @page {
	    size: A4
		}

		@page:left {
			@bottom-right {
			   content: counter(page)
			}
			@top-left {
				content: "ISO/IEC 23001-16"
			}
			@bottom-left {
				content: "© ISO/IEC 2020 – All rights reserved"
			}

		}

		@page:right {
			@bottom-left {
			   content: counter(page)
			}
			@top-right {
				content: "ISO/IEC 23001-16"
			}
			@bottom-right {
				content: "© ISO/IEC 2020 – All rights reserved"
			}

		}

		#contents {page-break-before: always;}
		#scope {page-break-before: always;}
		#foreword {page-break-before: always;}

		#toc a:after {
			  content: leader('.') target-counter(attr(href), page);
			}
	}
  </style>
  <meta content="Bikeshed version 70ffa934, updated Fri May 1 10:12:04 2020 -0700" name="generator">
  <link href="http://www.iso.org/" rel="canonical">
  <link href="https://cdn.iso.org/resources/wood/3.0.14/img/iso/favicon/red/favicon.ico" rel="icon">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: #DDDDDD;
    color: black;
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: black; }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-syntax-highlighting */

.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <div align="right" style="margin: 1in 0 1in 0;">
    <p data-fill-with="logo"><a class="logo" href="https://www.iso.org/"> <img alt="ISO" height="72" src="https://cdn.iso.org/resources/wood/3.0.14/img/iso/iso-logo-print.gif" width="72"> </a></p>
   </div>
   <div align="right">
    <p style="margin: 1in 0 0 0; font-weight: bold; font-size: 24px">ISO/IEC 23001-16</p>
    <p>ISO/IEC JTC 1/SC 29/WG 11</p>
    <p style="margin:0 0 1n 0;">Secretariat: JISC</p>
   </div>
   <h1 align="center" class="p-name no-ref" id="title">Information technology — MPEG systems technologies — Part 16: Derived visual tracks in the ISO base media file format</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Committee Draft, <span class="dt-updated"><span class="value-title" title="20200518">18 May 2020</span></span></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://www.iso.org/">http://www.iso.org/</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><span class="p-name fn">Frederic Mazé</span>
    </dl>
   </div>
   <div data-fill-with="warning">
    <details class="annoying-warning" open>
     <summary>Warning for WDs and CDs</summary>
     <p>This document is not an ISO International Standard. It is distributed for review and comment. It is subject to change without notice and may not be referred to as an International Standard. Recipients of this draft are invited to submit, with their comments, notification of any relevant patent rights of which they are aware and to provide supporting documentation.</p>
    </details>
   </div>
   <p class="copyright" data-fill-with="copyright">
    <p>© ISO 2020</p>
    <p>All rights reserved. Unless otherwise specified, or required in the context of its implementation, no part of this publication may be reproduced or utilized otherwise in any form or by any means, electronic or mechanical, including photocopying, or posting on the internet or an intranet, without prior written permission. Permission can be requested from either ISO at the address below or ISO’s member body in the country of the requester.</p>
    <div style="text-indent: 50px;">
     <p style="margin: 0 0;">ISO copyright office</p>
     <p style="margin: 0 0;">CP 401 • Ch. de Blandonnet 8</p>
     <p style="margin: 0 0;">CH-1214 Vernier, Geneva</p>
     <p style="margin: 0 0;">Phone: +41 22 749 01 11</p>
     <p style="margin: 0 0;">Email: <a href="mailto:copyright@iso.org">copyright@iso.org</a></p>
     <p style="margin: 0 0;">Website: <a href="http://www.iso.org/">www.iso.org</a></p>
     <p style="margin: 0 0;">Published in Switzerland</p>
    </div>
   </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract"></div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#foreword"><span class="secno"></span> <span class="content">Foreword</span></a>
    <li><a href="#scope"><span class="secno">1</span> <span class="content">Scope</span></a>
    <li>
     <a href="#terms"><span class="secno">2</span> <span class="content">Terms and definitions</span></a>
     <ol class="toc">
      <li><a href="#p-derivation-operation"><span class="secno">2.1</span> <span class="content"><span>derivation operation</span></span></a>
      <li><a href="#p-derivation-transformation"><span class="secno">2.2</span> <span class="content"><span>derivation transformation</span></span></a>
      <li><a href="#p-derived-sample"><span class="secno">2.3</span> <span class="content"><span>derived sample</span></span></a>
      <li><a href="#p-derived-visual-track"><span class="secno">2.4</span> <span class="content"><span>derived visual track</span></span></a>
     </ol>
    <li><a href="#principles"><span class="secno">3</span> <span class="content">Derived visual tracks, design principles</span></a>
    <li><a href="#operation"><span class="secno">4</span> <span class="content">Derivation operation</span></a>
    <li>
     <a href="#sample-entry"><span class="secno">5</span> <span class="content">Sample entry of derived visual track</span></a>
     <ol class="toc">
      <li><a href="#config"><span class="secno">5.1</span> <span class="content">Derived visual track configuration record</span></a>
     </ol>
    <li><a href="#sample"><span class="secno">6</span> <span class="content">Sample of derived visual track</span></a>
    <li><a href="#example"><span class="secno">7</span> <span class="content">Examples of derivation transformations</span></a>
    <li><a href="#examples"><span class="secno">8</span> <span class="content">Example of derivation operations processing</span></a>
    <li>
     <a href="#transformations"><span class="secno">9</span> <span class="content">Derivation transformations</span></a>
     <ol class="toc">
      <li><a href="#p-identity"><span class="secno">9.1</span> <span class="content">Identity</span></a>
      <li><a href="#p-dissolve"><span class="secno">9.2</span> <span class="content">Dissolve</span></a>
      <li><a href="#crop"><span class="secno">9.3</span> <span class="content">Crop</span></a>
      <li><a href="#rotation"><span class="secno">9.4</span> <span class="content">Rotation</span></a>
      <li><a href="#mirror"><span class="secno">9.5</span> <span class="content">Mirror</span></a>
      <li><a href="#scaling"><span class="secno">9.6</span> <span class="content">Scaling</span></a>
      <li><a href="#roi"><span class="secno">9.7</span> <span class="content">Region of interest (ROI) selection</span></a>
      <li><a href="#trackgrid"><span class="secno">9.8</span> <span class="content">Track Grid Composition</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="no-num heading settled" id="foreword"><span class="content">Foreword</span></h2>
   <p>ISO (the International Organization for Standardization) is a worldwide
federation of national standards bodies (ISO member bodies). The work of
preparing International Standards is normally carried out through ISO
technical committees. Each member body interested in a subject for which
a technical committee has been established has the right to be
represented on that committee. International organizations, governmental
and non-governmental, in liaison with ISO, also take part in the work.
ISO collaborates closely with the International Electrotechnical
Commission (IEC) on all matters of electrotechnical standardization.</p>
   <p>The procedures used to develop this document and those intended for its
further maintenance are described in the ISO/IEC Directives, Part 1. In
particular, the different approval criteria needed for the different
types of ISO documents should be noted. This document was drafted in
accordance with the editorial rules of the ISO/IEC Directives, Part 2
(see <a href="https://www.iso.org/directives-and-policies.html">www.iso.org/directives</a>).</p>
   <p>Attention is drawn to the possibility that some of the elements of this
document may be the subject of patent rights. ISO shall not be held
responsible for identifying any or all such patent rights. Details of
any patent rights identified during the development of the document will
be in the Introduction and/or on the ISO list of patent declarations
received (see <a href="https://www.iso.org/iso-standards-and-patents.html">www.iso.org/patents</a>).</p>
   <p>Any trade name used in this document is information given for the
convenience of users and does not constitute an endorsement.</p>
   <p>For an explanation of the voluntary nature of standards, the meaning of
ISO specific terms and expressions related to conformity assessment, as
well as information about ISO’s adherence to the World Trade
Organization (WTO) principles in the Technical Barriers to Trade (TBT),
see <a href="https://www.iso.org/foreword-supplementary-information.html">www.iso.org/iso/foreword.html</a>.</p>
   <p>This document was prepared by Joint Technical Committee ISO/IEC JTC 1, <em>Information technology</em>, Subcommittee SC 29, <em>Coding of audio, picture,
multimedia and hypermedia information</em>.</p>
   <p>A list of all parts in the ISO/IEC 23001 series can be found on the ISO
website.</p>
   <p>Any feedback or questions on this document should be directed to the
user’s national standards body. A complete listing of these bodies can
be found at <a href="https://www.iso.org/members.html">www.iso.org/members.html</a>.</p>
   <div data-fill-with="abstract">
    <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
    <p>Derived visual tracks are designed to enable defining a timed sequence of visual transformation operations to be applied to input images and/or samples of input tracks. It is built using tools defined in the ISO base media file format (ISO/IEC 14496-12). This document specifies the core design and a set of transformation operations</p>
   </div>
   <h2 class="heading settled" data-level="1" id="scope"><span class="secno">1. </span><span class="content">Scope</span><a class="self-link" href="#scope"></a></h2>
   <p>This document defines a storage format for derived visual tracks and an
associated set of transformation operations. The format defined in this
document enable the interchange, editing, and display of timed sequence
of images that result from transformation operations applied to input
still images or timed sequence of images.</p>
   <p>This format defines normative structures used to contain the description
of transformation operations, how to link that transformation operations
to the input images, and defines how to process those transformation
operations to obtain a timed sequence of output images.</p>
   <h2 class="heading settled" data-level="2" id="terms"><span class="secno">2. </span><span class="content">Terms and definitions</span><a class="self-link" href="#terms"></a></h2>
   <p>For the purposes of this document, the terms and definitions given in <a data-link-type="biblio" href="#biblio-iso14496-12">[iso14496-12]</a> and the following apply.</p>
   <p>ISO and IEC maintain terminological databases for use in standardization
at the following addresses:</p>
   <p>— ISO Online browsing platform: available at <span class="underline">https://www.iso.org/obp</span></p>
   <p>— IEC Electropedia: available at <span class="underline">http://www.electropedia.org/</span></p>
   <h3 class="heading settled" data-level="2.1" id="p-derivation-operation"><span class="secno">2.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="derivation-operation">derivation operation</dfn></span><a class="self-link" href="#p-derivation-operation"></a></h3>
    container box of type <code>'dimg'</code> representing an operation applying a <a data-link-type="dfn" href="#derivation-transformation" id="ref-for-derivation-transformation">derivation transformation</a> on an ordered list of input images or
samples 
   <h3 class="heading settled" data-level="2.2" id="p-derivation-transformation"><span class="secno">2.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="derivation-transformation">derivation transformation</dfn></span><a class="self-link" href="#p-derivation-transformation"></a></h3>
   <p>visual transformation operation identified by a 4CC and a set of
parameters</p>
   <h3 class="heading settled" data-level="2.3" id="p-derived-sample"><span class="secno">2.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="derived-sample">derived sample</dfn></span><a class="self-link" href="#p-derived-sample"></a></h3>
   <div class="Definition">
    <p>sample containing an ordered list of <a data-link-type="dfn" href="#derivation-operation" id="ref-for-derivation-operation">derivation operation</a>s</p>
    <h3 class="heading settled" data-level="2.4" id="p-derived-visual-track"><span class="secno">2.4. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport id="derived-visual-track">derived visual track<a class="self-link" href="#derived-visual-track"></a></dfn></span><a class="self-link" href="#p-derived-visual-track"></a></h3>
    <p>visual track with a sample entry of type <code>'dtrk'</code> that is composed of a
timed sequence of related <a data-link-type="dfn" href="#derived-sample" id="ref-for-derived-sample">derived sample</a>s</p>
    <h2 class="heading settled" data-level="3" id="principles"><span class="secno">3. </span><span class="content">Derived visual tracks, design principles</span><a class="self-link" href="#principles"></a></h2>
    <p>A new track called the derived visual track is defined in this
subclause. Basically, a derived visual track is a visual track for which
output samples are the result of applying an ordered list of derivation
operations, each derivation operation applying a derivation
transformation on an ordered list of input images or samples.</p>
    <p>A derived visual track is similar in structure to any other video track
in <a data-link-type="biblio" href="#biblio-iso14496-12">[iso14496-12]</a>. A derived visual track is identified by its
containing sample entry of type <code>'dtrk'</code> <code>DerivedVisualSampleEntry</code>. Each
sample referring to a <code>DerivedVisualSampleEntry</code> is a derived sample. The
handler type for a track containing a <code>DerivedVisualSampleEntry</code> shall be <code>'pict'</code> or <code>'vide'</code>.</p>
    <p>A derived visual track shall include a <code>TrackReferenceTypeBox</code> with <code>reference_type</code> equal to <code>'dtrk'</code> referring to all the visual inputs:</p>
    <ol>
     <li data-md>
      <p>the track ID values of all tracks used by derived samples in the track and</p>
     <li data-md>
      <p>the item ID values of all image items used by derived samples of the track.</p>
    </ol>
    <p>An ID value in the track references is resolved to a track ID whenever
the file contains a track with such ID, and is resolved to an item ID
otherwise. An ID value in a <code>TrackReferenceTypeBox</code> with <code>reference_type</code> equal to <code>'dtrk'</code> shall not reference a track group ID.</p>
    <p>A derived sample contains an ordered list of the derivation operations
to be performed, each derivation operation applying a derivation
transformation on an ordered list of input images or samples.</p>
    <p class="note" role="note"><span>NOTE:</span> The layer syntax element in <code>TrackHeaderBox</code> has no impact on
ordering the inputs for derived samples.</p>
    <p>The four-character types of derivation transformation from all
derivation operations used by the derived samples in the track are
listed in the <code>DerivedVisualSampleEntry</code>, and also default inputs and
parameter values can be supplied there. A derived sample in the track
may use all or some of the derivation operations listed in the linked <code>DerivedVisualSampleEntry</code>, but samples shall not use a derivation
operation not listed in the sample entry.</p>
    <p>The derived sample durations document the time over which the derivation
represented by the ordered list of derivation operations is active.
Therefore, the number of samples defined in a derived visual track does
not necessarily match 1:1 with the number of input images or samples
that are being transformed. A single derivation duration may span
multiple samples in the source track(s), and also derived samples may
have 'internal time structure' (e.g. a cross-fade) so the picture may
change during the sample duration. This is in contrast to 'classic
video'.</p>
    <p>Derived visual tracks do not use composition-time re-ordering on inputs.
They operate on the composition timeline (i.e. before the application of
edit lists) of their input tracks. However, the input tracks shall not
have edit lists.</p>
    <p class="note" role="note">[Editor’s note: it is stated “However, the input tracks shall not have
edit lists”, but what about a derived visual track with temporal
re-mapping (as suggested in NOTE 3 below) that a content creator might
want to use as an input. It seems that would be forbidden due to the
“shall be”. Should we clarify it in NOTE 3 below?]</p>
    <p class="note" role="note"><span>NOTE:</span> When time-alignment adjustment between input tracks is needed,
signed composition offsets in input tracks may be used.</p>
    <p class="note" role="note"><span>NOTE:</span> A derived visual track may have an edit list; thus, it is
possible to re-time a track by using a derived visual track with an
identity transform but with an edit-list that causes temporal
re-mapping.</p>
    <p>The input images or samples for the derived sample can be either image
items or output samples from video or image sequence tracks (including
derived visual tracks), or a default input fill colour.</p>
    <p class="note" role="note"><span>NOTE:</span> Transformative item properties or transformations (e.g. clean
aperture, track matrix etc…) associated with input images or samples are
always applied before performing the derivation operation.</p>
    <p class="note" role="note"><span>NOTE:</span> If a derived sample needs to refer to one explicit sample value
in a referred track (other than the time-aligned sample value), an item
may be created and referred that has the same data as the desired sample
value.</p>
    <p>The input image items or samples used as input in a derived sample shall
have consistent pixel aspect ratio and bit depth. The input image items
or samples, and derived samples may have various width and height. When
differences in width and height result in pixels that never get
‘painted’ by a derivation operation, those empty pixels are filled
according to the value of <code>default_derivation_input</code> parameter signalled
in <code>DerivedVisualTrackConfigRecord</code> (black, white or grey pixels). When
differences in width and height result in pixels that end up outside the
output visual size by a derivation operation, those pixels are cropped.
This default behaviour may be overridden by derivation operation
specifications.</p>
    <p>A derived sample is reconstructed by performing the specified derivation
operations in sequence. Some derivation operations can be marked as
non-essential which indicates that the derivation operation may be
skipped by the reader. However, the operations marked as essential must
be used in order to obtain a valid derived sample.</p>
    <p>When more than one derivation operation is listed in a derived sample,
the derivation operation that is not first in the list may include the
output result (e.g. the output image) of any of the previous derivation
operations, only new inputs, or a combination of both.</p>
    <p>In many cases the source tracks pointed to by the <code>'dtrk'</code> track reference
are not intended for display. When a track is not intended for display, <code>track_in_movie</code> shall be equal to 0 for that track.</p>
    <p>The output image of a derived sample is the output from the last
derivation operation in the sample. If there is no derivation operation,
an empty derived sample (i.e. sample size of 0) is equivalent to an
empty edit, i.e., there is no visual output image from the derived
visual track at that time.</p>
    <h2 class="heading settled" data-level="4" id="operation"><span class="secno">4. </span><span class="content">Derivation operation</span><a class="self-link" href="#operation"></a></h2>
    <h3 class="no-toc heading settled" data-level="4.1" id="dimg-definition"><span class="secno">4.1. </span><span class="content">Definition</span><a class="self-link" href="#dimg-definition"></a></h3>
<pre class="def">Box Type: 'dimg'  
Container: derived sample or DerivedVisualTrackConfigRecord in a
DerivedVisualSampleEntry  
Mandatory: Yes  
Quantity: At least one
</pre>
    <p>A derivation transformation in a derivation operation is identified by a
four-character code (4CC), unless that code is <code>'uuid'</code>, whereupon a UUID
identifies a vendor-specific derivation operation.</p>
    <p>A derivation operation in either a derived sample entry or derived
sample is represented by a container box of type <code>'dimg'</code> that always
carries a derivation transformation box inherited from <code>VisualDerivationBase</code> with the 4CC identifying the derivation
transformation, and can carry a derivation-inputs box. A derivation
transformation’s parameters shall</p>
    <ol>
     <li data-md>
      <p>be single, countable</p>
     <li data-md>
      <p>have defined default values in the specification</p>
    </ol>
    <p>For both inputs and parameters, there is a bit-mask in the sample entry
and a bit-mask in the derived sample that uses the derivation, defining
whether the parameter value or input is supplied there.</p>
    <p>Each parameter takes the value defined in that derived sample, if any,
or else the value defined in the sample entry, if any, or else the
default value for that parameter defined in the derivation
specification.</p>
    <p>Each input takes, in precedence order:</p>
    <ol>
     <li data-md>
      <p>the input listed in the derived sample if present;</p>
     <li data-md>
      <p>the default input listed in the sample-entry, if present;</p>
     <li data-md>
      <p>or the default input fill defined in the configuration record for the derived visual track.</p>
    </ol>
    <p>Each input can be</p>
    <ol>
     <li data-md>
      <p>an index into the track reference box for the derived visual track (itself indicating an input image item or input track);</p>
     <li data-md>
      <p>a relative index of previous derivation operations in the same derived sample;</p>
     <li data-md>
      <p>or the default input fill defined in the configuration record for this derived visual track.</p>
    </ol>
    <p>The default input is signalled in the <code>DerivedVisualTrackConfigRecord</code> in
the derived visual track sample entry (e.g. either a full black, mid
grey or full white picture).</p>
    <p>If no inputs are defined in the sample entry, the box may be absent
there; if none are defined in the derived sample (presumably at least
some are defined in the sample entry) then the box may be absent there.</p>
    <p>Bits in the masks are assigned from least-significant (first input or
parameter) upwards. Their default value is 0 (i.e. if the operation has
9 inputs and only 8 bits are supplied, the 9<sup>th</sup> bit is assumed
to be zero).</p>
    <p>The version is currently constrained to be 0; only one flag is defined,
the low-order bit. When set to 1, it indicates that the operation is
essential. If any derived sample sets this but for a given derivation
transformation type (code), then the sample entry shall set this bit. A
parser shall not process a derived visual track that contains a
derivation operation marked in the sample entry as essential that is not
recognized or not supported by the parser. If a non-essential derivation
operation is not supported, the derived sample containing it may be
processed as if it had been removed from the sequence of derivation
operations in that derived sample.</p>
    <h3 class="no-toc heading settled" data-level="4.2" id="dimg-syntax"><span class="secno">4.2. </span><span class="content">Syntax</span><a class="self-link" href="#dimg-syntax"></a></h3>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="visualderivationbase"><c- n>VisualDerivationBase</c-></dfn> 
<c- n>extends</c-> <c- n>FullBox</c-> <c- p>(</c-><c- n>code</c-><c- p>,</c-> <c- n>version</c-> <c- o>=</c-> <c- mi>0</c-><c- p>,</c-> <c- n>flags</c-><c- p>,</c-> <c- n>optional</c-> <c- b>unsigned</c-> <c- b>int</c-><c- p>(</c-><c- mi>8</c-><c- p>)[</c-><c- mi>16</c-><c- p>]</c-> <c- n>uuid_code</c-><c- p>){</c->
  <c- k>if</c-> <c- p>(</c-><c- n>code</c-><c- o>==</c->'<c- n>uuid</c->'<c- p>)</c-> <c- p>{</c->
    <c- b>unsigned</c-> <c- b>int</c-><c- p>(</c-><c- mi>8</c-><c- p>)[</c-><c- mi>16</c-><c- p>]</c-> <c- n>usertype</c-> <c- o>=</c-> <c- n>uuid_code</c-><c- p>;</c->
  <c- p>}</c->
  <c- b>unsigned</c-> <c- b>int</c-><c- p>(</c-><c- mi>16</c-><c- p>)</c-> <c- n>parameter_count</c-><c- p>;</c->
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- n>floor</c-><c- p>((</c-><c- n>parameter_count</c-><c- o>+</c-><c- mi>7</c-><c- p>)</c-><c- o>/</c-><c- mi>8</c-><c- p>))</c-><c- o>*</c-><c- mi>8</c-><c- p>)</c-> <c- n>parameter_defined_flags</c-><c- p>;</c->
<c- p>}</c->

<c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="visualderivationinputs"><c- n>VisualDerivationInputs</c-><a class="self-link" href="#visualderivationinputs"></a></dfn> 
<c- n>extends</c-> <c- n>FullBox</c-> <c- p>(</c->'<c- n>dinp</c->'<c- p>,</c-> <c- n>version</c-> <c- o>=</c-> <c- mi>0</c-><c- p>,</c-> <c- n>flags</c-> <c- o>=</c-> <c- mi>0</c-><c- p>){</c->
  <c- b>unsigned</c-> <c- b>int</c-><c- p>(</c-><c- mi>16</c-><c- p>)</c-> <c- n>input_count</c-><c- p>;</c->
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- n>floor</c-><c- p>((</c-><c- n>input_count</c-><c- o>+</c-><c- mi>7</c-><c- p>)</c-><c- o>/</c-><c- mi>8</c-><c- p>))</c-><c- o>*</c-><c- mi>8</c-><c- p>)</c-> <c- n>input_present_flags</c-><c- p>;</c->
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>16</c-><c- p>)</c-> <c- n>reference_index</c-><c- p>[];</c->
<c- p>}</c->

<c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="visualderivation"><c- n>VisualDerivation</c-><a class="self-link" href="#visualderivation"></a></dfn> <c- n>extends</c-> <c- n>Box</c-> <c- p>(</c->'<c- n>dimg</c->'<c- p>){</c->
  <c- n>VisualDerivationBase</c-><c- p>()</c->  <c- n>derivation_transformation</c-><c- p>;</c->  <c- c1>// actually an instance of a derived class</c->
  <c- n>VisualDerivationInputs</c->  <c- n>inputs</c-><c- p>;</c->  <c- c1>// optional </c->
<c- p>}</c->
</pre>
    <h3 class="no-toc heading settled" data-level="4.3" id="dimg-semantics"><span class="secno">4.3. </span><span class="content">Semantics</span><a class="self-link" href="#dimg-semantics"></a></h3>
    <ul>
     <li data-md>
      <p><code>parameter_count</code> provides the number of parameters present in the derivation transformation box. Default value is 0.</p>
     <li data-md>
      <p><code>parameter_defined_flags</code> is a bit-mask that indicates which parameter is present in the derivation transformation box. If the Nth bit is the highest bit set in the flags, then the first through Nth parameters must be present, even if some are not defined by the values here. Default value is 0.</p>
    </ul>
    <p class="note" role="note"><span>NOTE:</span> When there is no parameter present in the derivation
transformation box, parameter_count and parameter_defined_flags can
be omitted (box size equals to empty box size would indicates there is
no attribute in the box).</p>
    <ul>
     <li data-md>
      <p><code>input_count</code> provides the number of input present in the
VisualDerivationInputs box. Default value is 0.</p>
    </ul>
    <p class="note" role="note"><span>NOTE:</span> When there is no input present in the box, the
VisualDerivationInputs box can be omitted.</p>
    <ul>
     <li data-md>
      <p><code>input_present_flags</code> is a bit-mask that indicates which input is
present in the box. If the Nth bit is the highest bit set in the flags,
then there must be N entries in the reference array <code>track_reference_index[]</code>. Default value is 0.</p>
     <li data-md>
      <p><code>reference_index</code> is an array (of size input_count) that provides the
Nth input to the derivation operation when the Nth bit of <code>input_present_flags</code> is set to 1 as described below:</p>
      <ul>
       <li data-md>
        <p>When the value is less than <code>0x8000</code>, the value is the 1-based index
to the <code>TrackReferenceTypeBox</code> of type <code>'dtrk'</code> that designates the ID
of the track or item to use as input.</p>
       <li data-md>
        <p>When the value is more than <code>0x8000</code>, the value minus <code>0x8000</code> provides
the 1-based relative index to the preceding derivation operation
whose output image must be used as input.</p>
       <li data-md>
        <p>The value 0 indicates the default input as signaled in <code>DerivedVisualTrackConfigRecord</code>.</p>
       <li data-md>
        <p>Value <code>0x8000</code> is reserved.</p>
      </ul>
    </ul>
    <p>The value of the Nth entry is undefined when the Nth bit of <code>input_present_flags</code> has the value 0. Value 0 is undefined.</p>
    <h2 class="heading settled" data-level="5" id="sample-entry"><span class="secno">5. </span><span class="content">Sample entry of derived visual track</span><a class="self-link" href="#sample-entry"></a></h2>
    <p>The sample entry for a derived visual track is defined as follows:</p>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="derivedvisualsampleentry"><c- n>DerivedVisualSampleEntry</c-><a class="self-link" href="#derivedvisualsampleentry"></a></dfn>  
<c- n>extends</c-> <c- n>VisualSampleEntry</c-> <c- p>(</c->'<c- n>dtrk</c->'<c- p>){</c->  
  <c- n>DerivedVisualTrackConfigRecord</c-> <c- n>derived_config</c-><c- p>;</c-> <c- c1>// mandatory  </c->
<c- p>}</c->
</pre>
    <p>The sample entry documents all the possible derivation operations used
in the derived samples of the derived visual track. Derivation
operations that occur in derived samples must have a matching entry in
the configuration box. Readers may discard any other derivation
operations.</p>
    <h3 class="heading settled" data-level="5.1" id="config"><span class="secno">5.1. </span><span class="content">Derived visual track configuration record</span><a class="self-link" href="#config"></a></h3>
    <h4 class="no-toc heading settled" data-level="5.1.1" id="config-definition"><span class="secno">5.1.1. </span><span class="content">Definition</span><a class="self-link" href="#config-definition"></a></h4>
<pre class="def">Box Type: DerivedVisualTrackConfigRecord  
Container: DerivedVisualSampleEntry  
Mandatory: Yes in a track containing a DerivedVisualSampleEntry  
Quantity: One
</pre>
    <p>When derivation_method is equal to 1, the derived visual track shall
include one or both of a <code>TrackReferenceTypeBox</code> with <code>reference_type</code> equal to <code>'ctln'</code> indicating one input track providing the composition
timeline for this derived visual track.</p>
    <p>A derivation operation may supply in its definition the value of the <code>default_derivation_input</code> attribute to define its own default input.</p>
    <h4 class="no-toc heading settled" data-level="5.1.2" id="config-syntax"><span class="secno">5.1.2. </span><span class="content">Syntax</span><a class="self-link" href="#config-syntax"></a></h4>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="visualderivationdefault"><c- n>VisualDerivationDefault</c-><a class="self-link" href="#visualderivationdefault"></a></dfn><c- p>()</c->  
<c- n>extends</c-> <c- n>FullBox</c-> <c- p>(</c->'<c- n>dtrD</c->'<c- p>,</c-> <c- n>version</c-> <c- o>=</c-> <c- mi>0</c-><c- p>,</c-> <c- n>flags</c-> <c- o>=</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->  
    <c- b>unsigned</c-> <c- b>int</c-><c- p>(</c-><c- mi>2</c-><c- p>)</c-> <c- n>default_derivation_input</c-><c- p>;</c->  
    <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>2</c-><c- p>)</c-> <c- n>derivation_method</c-><c- p>;</c->  
    <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>4</c-><c- p>)</c-> <c- n>reserved</c-><c- p>;</c->  
<c- p>}</c->

<c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="derivedvisualtrackconfigrecord"><c- n>DerivedVisualTrackConfigRecord</c-><a class="self-link" href="#derivedvisualtrackconfigrecord"></a></dfn><c- p>()</c-> <c- n>extends</c-> <c- n>Box</c-> <c- p>(</c->'<c- n>dtrC</c->'<c- p>)</c->
<c- p>{</c->  
    <c- n>VisualDerivationDefault</c-> <c- n>derived_default_config</c-><c- p>;</c->  
    <c- n>VisualDerivation</c-> <c- n>derivation_operations</c-><c- p>[];</c-> <c- c1>// to fill box  </c->
<c- p>}</c->
</pre>
    <h4 class="no-toc heading settled" data-level="5.1.3" id="config-semantics"><span class="secno">5.1.3. </span><span class="content">Semantics</span><a class="self-link" href="#config-semantics"></a></h4>
    <ul>
     <li data-md>
      <p><code>default_derivation_input</code> indicates the default input. Value 0
corresponds to a full black picture, value 1 corresponds to a full white
picture and value 2 corresponds to a mid-grey picture. Value 3 is
reserved.</p>
     <li data-md>
      <p><code>derivation_method</code> indicates the derivation method to be used for
determining the timing and number of output samples relatively to the
composition timeline (i.e. before the application of the edit lists of
the derived visual track).</p>
      <ul>
       <li data-md>
        <p>When equal 0, the timing and number of output samples correspond to the temporal combination of samples of any of all input tracks or of the derived visual track itself (default behavior). (That is, there is conceptually a new output sample at least whenever any input changes).</p>
       <li data-md>
        <p>When equal 1, the timing and number of output samples correspond to the temporal combination of samples of the input track provided by track reference of type <code>'ctln'</code>.</p>
       <li data-md>
        <p>When equal 2, the timing and number of output samples are aligned with the samples of the derived visual track.</p>
       <li data-md>
        <p>When equal 3, the timing and number of output samples is not mandated and are derived by the client (e.g. it matches the display refresh rate, or the derivation operation represents a time-based operation such as a cross-fade).</p>
      </ul>
    </ul>
    <p class="note" role="note"><span>NOTE:</span> The derived visual track may have edit lists whatever is the
derivation method. When present, they provide the timing and number of
output samples of the derived visual track on the presentation timeline.
If the derived visual track does not have an edit-list then its
presentation timeline is equal to its composition timeline.</p>
    <h2 class="heading settled" data-level="6" id="sample"><span class="secno">6. </span><span class="content">Sample of derived visual track</span><a class="self-link" href="#sample"></a></h2>
    <h3 class="no-toc heading settled" data-level="6.1" id="sample-general"><span class="secno">6.1. </span><span class="content">Definition</span><a class="self-link" href="#sample-general"></a></h3>
    <p>The sample format for the sample entry DerivedVisualSampleEntry consists
of a set of derivation operations to be applied in sequence, starting
with the first in the sample.</p>
    <h3 class="no-toc heading settled" data-level="6.2" id="sample-syntax"><span class="secno">6.2. </span><span class="content">Syntax</span><a class="self-link" href="#sample-syntax"></a></h3>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="derivedsample"><c- n>DerivedSample</c-><a class="self-link" href="#derivedsample"></a></dfn><c- p>(){</c->  
  <c- n>VisualDerivation</c-> <c- n>derivation_operations</c-><c- p>[];</c-> <c- c1>// to fill sample  </c->
<c- p>}</c->
</pre>
    <h2 class="heading settled" data-level="7" id="example"><span class="secno">7. </span><span class="content">Examples of derivation transformations</span><a class="self-link" href="#example"></a></h2>
    <h3 class="no-toc heading settled" data-level="7.1" id="xfad-definition"><span class="secno">7.1. </span><span class="content">Definition</span><a class="self-link" href="#xfad-definition"></a></h3>
<pre class="def">Derivation Type: 'xfad'  
Inputs: (1) starting visual ('from') (2) ending visual ('to')  
Parameters: (1) initial proportion; (2) final proportion
</pre>
    <p>Imagine a cross-fade derivation transformation that takes two inputs and
cross-fades from the initial-proportion parameter to the
final-proportion parameter (hence, it has two parameters). Assume we
also have an identity derivation transformation that simply repeats its
only input, and has no parameters.</p>
    <h3 class="no-toc heading settled" data-level="7.2" id="xfad-syntax"><span class="secno">7.2. </span><span class="content">Syntax</span><a class="self-link" href="#xfad-syntax"></a></h3>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <c- n>crossfade</c-><c- p>()</c-> <c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- n>cfad</c->'<c- p>)</c-> <c- p>{</c->  
  <c- b>unsigned</c-> <c- b>int</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>initial_proportion</c-><c- p>;</c-> <c- c1>// default 0  </c->
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>final_proportion</c-><c- p>;</c-> <c- c1>// default 255 i.e. 100%  </c->
<c- p>}</c->

<c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <c- n>identity</c-><c- p>()</c-> <c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase①"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- n>iden</c->'<c- p>)</c-> <c- p>{</c->  
<c- p>}</c->
</pre>
    <h2 class="heading settled" data-level="8" id="examples"><span class="secno">8. </span><span class="content">Example of derivation operations processing</span><a class="self-link" href="#examples"></a></h2>
    <p>Assume that we say black is the default input. We might find in the
derived sample entry:</p>
<pre>VisualDerivation  
  crossfade  
    parameter_count is absent (implied zero) , no parameters supplied here  
    parameters_mask is absent (implied zero), no parameters supplied here  
    (VisualDerivationInputs) box not defined - no inputs supplied here  
    input_count (implied zero), no inputs supplied here  
    input mask (implied zero), no inputs supplied here  
VisualDerivation  
  identity  
    parameter_count is absent (implied zero), no parameters supplied here  
    parameters_mask is absent (implied zero), no parameters supplied here  
    VisualDerivationInputs  
    input_count = 1  
    input mask is 1,  
    input[1] = 1; // for the first track reference
</pre>
    <p>The track has a single reference of type <code>'dtrk'</code> to a video track.</p>
    <p>The first sample lasts 5 seconds which causes a fade-from-black and has:</p>
<pre>VisualDerivation 0 crossfade (use default values)  
    parameter_count is absent (implied zero), no parameters supplied here  
    parameters_mask is absent (implied zero), no parameters supplied here  
  VisualDerivationInputs  
    input_count = 2  
    input mask is 0x2, second input supplied here  
    input[1] = 0; // ignored, defaulted to black  
    input[2] = 1; // first track reference
</pre>
    <p>The second sample has a long duration and simply copies the input:</p>
<pre>VisualDerivation 0 identity  
  parameter_count is absent (implied zero), no parameters supplied here  
  parameters_mask is absent (implied zero), no parameters supplied here
</pre>
    <p>The third sample lasts 5 seconds which causes a fade-to-black and has:</p>
<pre>VisualDerivation 0 crossfade  
  parameter_count = 2  
    parameters_mask = 0x3  
    initial_proportion = 255  
    final_proportion = 0  
  VisualDerivationInputs  
    input_count = 1  
    input mask is 0x1, first input supplied here  
    input[1] = 1; // first track reference  
    input[2] is absent (implied zero), defaulted to black
</pre>
    <p>An example of chaining might be a sample which f chains a hypothetical
contrast adjustment into a cross-fade:</p>
<pre>VisualDerivation 0 contrast-adjust  
  parameter_count is absent (implied zero), no parameters supplied here  
  parameters_mask is absent (implied zero), no parameters supplied here  
  VisualDerivationInputs  
    input_count = 1  
    input mask is 0x1, first input supplied here  
    input[1] = 1; // first track reference  
VisualDerivation 1 crossfade  
  parameter_count = 2  
    parameters_mask = 0x3  
    initial_proportion = 255  
    final_proportion = 0  
  VisualDerivationInputs  
    input_count = 1  
    input mask is 0x1, first input supplied here  
    input[1] = -1; // output of the contrast adjustment  
    input[2] is absent (implied zero), defaulted to black
</pre>
    <h2 class="heading settled" data-level="9" id="transformations"><span class="secno">9. </span><span class="content">Derivation transformations</span><a class="self-link" href="#transformations"></a></h2>
    <table border="1">
     <caption>List of basic derivation transformations</caption>
     <thead>
      <tr class="header">
       <th><em><strong>Operation</strong></em>
       <th><em><strong>Inputs</strong></em>
       <th><em><strong>Parameters</strong></em>
     <tbody>
      <tr class="odd">
       <td>Identity
       <td>1
       <td>(none)
      <tr class="even">
       <td>Dissolve
       <td>2 (from, to)
       <td>
        <ol type="1">
         <li>
          <p>Initial proportion</p>
         <li>
          <p>Final proportion</p>
        </ol>
      <tr class="even">
       <td>Crop
       <td>1
       <td>
        <ol type="1">
         <li>
          <p>Width numerator</p>
         <li>
          <p>Width denominator</p>
         <li>
          <p>Height numerator</p>
         <li>
          <p>Height denominator</p>
         <li>
          <p>X offset numerator</p>
         <li>
          <p>X offset denominator</p>
         <li>
          <p>Y offset numerator</p>
         <li>
          <p>Y offset denominator</p>
         <li>
        </ol>
      <tr class="odd">
       <td>Rotate
       <td>1
       <td>
        <ol type="1">
         <li>
          <p>Angle (0º, 90º, 180º, 360º)</p>
        </ol>
      <tr class="even">
       <td>Mirror
       <td>1
       <td>
        <ol type="1">
         <li>
          <p>Horizontal or Vertical mirroring</p>
        </ol>
      <tr class="odd">
       <td>Scaling
       <td>1
       <td>
        <ol type="1">
         <li>
          <p>Target width numerator</p>
         <li>
          <p>Target width denominator</p>
         <li>
          <p>Target height numerator</p>
         <li>
          <p>Target height denominator</p>
        </ol>
      <tr class="even">
       <td>Region-of-interest
       <td>2 (visual track, ROI metadata)
       <td>(none)
      <tr class="odd">
       <td>Track Grid
       <td>N
       <td>
        <ol type="1">
         <li>
          <p>Output width</p>
         <li>
          <p>Output height</p>
         <li>
          <p>Rows</p>
         <li>
          <p>Columns</p>
        </ol>
    </table>
    <h3 class="heading settled" data-level="9.1" id="p-identity"><span class="secno">9.1. </span><span class="content">Identity</span><a class="self-link" href="#p-identity"></a></h3>
    <h4 class="no-toc heading settled" data-level="9.1.1" id="identity-definition"><span class="secno">9.1.1. </span><span class="content">Definition</span><a class="self-link" href="#identity-definition"></a></h4>
<pre class="def">Box Type:  'idtt'  
Mandatory (per sample):  No  
Quantity (per sample):  Zero or one  
Inputs:  At most one
</pre>
    <p>The Identity derivation transformation reproduces the input image. When
a derivation operation with the Identity derivation transformation is
present in a derived sample, no other derivation operations should be
present in the same derived sample.</p>
    <h4 class="no-toc heading settled" data-level="9.1.2" id="identity-syntax"><span class="secno">9.1.2. </span><span class="content">Syntax</span><a class="self-link" href="#identity-syntax"></a></h4>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="identity"><c- n>Identity</c-><a class="self-link" href="#identity"></a></dfn><c- p>()</c->  
<c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase②"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- n>idtt</c->'<c- p>,</c-> <c- n>flags</c-><c- p>)</c-> <c- p>{</c->  
<c- p>}</c->
</pre>
    <h3 class="heading settled" data-level="9.2" id="p-dissolve"><span class="secno">9.2. </span><span class="content">Dissolve</span><a class="self-link" href="#p-dissolve"></a></h3>
    <p class="note" role="note">[Editor’s note: The definition below would need to be reviewed for
correctness, particularly the formula O(x,y) and weights startWeight and
endWeight that are cited but not used for the latter]</p>
    <h4 class="no-toc heading settled" data-level="9.2.1" id="dissolve-definition"><span class="secno">9.2.1. </span><span class="content">Definition</span><a class="self-link" href="#dissolve-definition"></a></h4>
<pre class="def">Box Type: 'dslv'  
Mandatory (per sample): No  
Quantity (per sample): Any  
Inputs: [1] starting input image A, [2] ending input image B
</pre>
    <p>The Dissolve derivation transformation provides smooth blending of two
input images gradually fading from the first image to the second image.
The output co-located pixel value, O(x,y) is computed by the weighted
summation of the two input images where the weights time-based
transitions of the proportions provided by startWeight and endWeight. In
the following equations, T transitions linearly from 0 at the time of
the derived sample start to 1 at the time of the derived sample end.</p>
    <p>The visual sizes of the input images are normalized to the size of the
larger one before the operation.</p>
<pre>O(x,y) = 
    A(x,y) * (T * (end_weight - start_weight) + start_weight) / 256 + 
    B(x,y) * ((1-T) * (end_weight - start_weight) + start_weight) / 256
</pre>
    <p>where '/' is a division by truncation. <code>O(x,y)</code> is saturated to the
dynamic range of the pixel values.</p>
    <h4 class="no-toc heading settled" data-level="9.2.2" id="dissolve-syntax"><span class="secno">9.2.2. </span><span class="content">Syntax</span><a class="self-link" href="#dissolve-syntax"></a></h4>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="dissolve"><c- n>Dissolve</c-><a class="self-link" href="#dissolve"></a></dfn>  
<c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase③"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- n>dslv</c->'<c- p>,</c-> <c- n>flags</c-><c- p>)</c-> <c- p>{</c->  
  <c- b>unsigned</c-> <c- b>int</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>end_weight_minus1</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>start_weight_minus1</c-><c- p>;</c->  
<c- p>}</c->
</pre>
    <h4 class="no-toc heading settled" data-level="9.2.3" id="dissolve-semantics"><span class="secno">9.2.3. </span><span class="content">Semantics</span><a class="self-link" href="#dissolve-semantics"></a></h4>
    <ul>
     <li data-md>
      <p><code>end_weight_minus1</code>, <code>start_weight_minus1</code> A value between 0 and 255
that gives the initial and final weights to be multiplied to collocated
input pixels.</p>
    </ul>
    <h3 class="heading settled" data-level="9.3" id="crop"><span class="secno">9.3. </span><span class="content">Crop</span><a class="self-link" href="#crop"></a></h3>
    <h4 class="no-toc heading settled" data-level="9.3.1" id="crop-definition"><span class="secno">9.3.1. </span><span class="content">Definition</span><a class="self-link" href="#crop-definition"></a></h4>
<pre class="def">Box Type: 'crop'  
Mandatory (per sample): No  
Quantity (per sample): Any  
Inputs: At most one
</pre>
    <p>The SampleCrop derivation transformation defines a cropping
transformation of the input image.</p>
    <h4 class="no-toc heading settled" data-level="9.3.2" id="crop-syntax"><span class="secno">9.3.2. </span><span class="content">Syntax</span><a class="self-link" href="#crop-syntax"></a></h4>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="samplecrop"><c- n>SampleCrop</c-><a class="self-link" href="#samplecrop"></a></dfn>  
<c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase④"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- n>crop</c->'<c- p>,</c-> <c- n>flags</c-><c- p>)</c-> <c- p>{</c->  
  <c- b>unsigned</c-> <c- b>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>cleanApertureWidthN</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>cleanApertureWidthD</c-><c- p>;</c->  
  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>cleanApertureHeightN</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>cleanApertureHeightD</c-><c- p>;</c->  
  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>horizOffN</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>horizOffD</c-><c- p>;</c->  
  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>vertOffN</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>vertOffD</c-><c- p>;</c->  
<c- p>}</c->
</pre>
    <h4 class="no-toc heading settled" data-level="9.3.3" id="crop-semantics"><span class="secno">9.3.3. </span><span class="content">Semantics</span><a class="self-link" href="#crop-semantics"></a></h4>
    <p>The semantics of the syntax elements within the SampleCrop derivation
transformation are the same as those specified for the syntax elements
of <code>CleanApertureBox</code> as defined in <a data-link-type="biblio" href="#biblio-iso14496-12">[iso14496-12]</a>.</p>
    <h3 class="heading settled" data-level="9.4" id="rotation"><span class="secno">9.4. </span><span class="content">Rotation</span><a class="self-link" href="#rotation"></a></h3>
    <h4 class="no-toc heading settled" data-level="9.4.1" id="rotation-definition"><span class="secno">9.4.1. </span><span class="content">Definition</span><a class="self-link" href="#rotation-definition"></a></h4>
<pre class="def">Box Type: 'srot'  
Mandatory (per sample): No  
Quantity (per sample): Any  
Inputs: At most one
</pre>
    <p>The SampleRotation derivation transformation rotates the input image in
anti-clockwise direction in units of 90 degrees.</p>
    <h4 class="no-toc heading settled" data-level="9.4.2" id="rotation-syntax"><span class="secno">9.4.2. </span><span class="content">Syntax</span><a class="self-link" href="#rotation-syntax"></a></h4>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="samplerotation"><c- n>SampleRotation</c-><a class="self-link" href="#samplerotation"></a></dfn>  
<c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase⑤"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- n>srot</c->'<c- p>,</c-> <c- n>flags</c-><c- p>)</c-> <c- p>{</c->  
  <c- b>unsigned</c-> <c- b>int</c-> <c- p>(</c-><c- mi>6</c-><c- p>)</c-> <c- n>reserved</c-> <c- o>=</c-> <c- mi>0</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-> <c- p>(</c-><c- mi>2</c-><c- p>)</c-> <c- n>angle</c-><c- p>;</c->  
<c- p>}</c->
</pre>
    <h4 class="no-toc heading settled" data-level="9.4.3" id="rotation-semantics"><span class="secno">9.4.3. </span><span class="content">Semantics</span><a class="self-link" href="#rotation-semantics"></a></h4>
    <ul>
     <li data-md>
      <p><code>angle</code> * 90 specifies the angle (in anti-clockwise direction) in units of degrees.</p>
    </ul>
    <h3 class="heading settled" data-level="9.5" id="mirror"><span class="secno">9.5. </span><span class="content">Mirror</span><a class="self-link" href="#mirror"></a></h3>
    <h4 class="no-toc heading settled" data-level="9.5.1" id="mirror-definition"><span class="secno">9.5.1. </span><span class="content">Definition</span><a class="self-link" href="#mirror-definition"></a></h4>
<pre class="def">Box Type: 'smir'  
Mandatory (per sample): No  
Quantity (per sample): Any  
Inputs: At most one
</pre>
    <p>The SampleMirror derivation transformation mirrors the input image about
either a vertical or horizontal axis.</p>
    <h4 class="no-toc heading settled" data-level="9.5.2" id="mirror-syntax"><span class="secno">9.5.2. </span><span class="content">Syntax</span><a class="self-link" href="#mirror-syntax"></a></h4>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="samplemirror"><c- n>SampleMirror</c-><a class="self-link" href="#samplemirror"></a></dfn>  
<c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase⑥"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- n>smir</c->'<c- p>,</c-> <c- n>flags</c-><c- p>)</c-> <c- p>{</c->  
  <c- b>unsigned</c-> <c- b>int</c-> <c- p>(</c-><c- mi>7</c-><c- p>)</c-> <c- n>reserved</c-> <c- o>=</c-> <c- mi>0</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-> <c- p>(</c-><c- mi>1</c-><c- p>)</c-> <c- n>axis</c-><c- p>;</c->  
<c- p>}</c->
</pre>
    <h4 class="no-toc heading settled" data-level="9.5.3" id="mirror-semantics"><span class="secno">9.5.3. </span><span class="content">Semantics</span><a class="self-link" href="#mirror-semantics"></a></h4>
    <ul>
     <li data-md>
      <p><code>axis</code> specifies a vertical (axis = 0) or horizontal (axis = 1) axis for the mirroring transformation.</p>
    </ul>
    <h3 class="heading settled" data-level="9.6" id="scaling"><span class="secno">9.6. </span><span class="content">Scaling</span><a class="self-link" href="#scaling"></a></h3>
    <h4 class="no-toc heading settled" data-level="9.6.1" id="scaling-definition"><span class="secno">9.6.1. </span><span class="content">Definition</span><a class="self-link" href="#scaling-definition"></a></h4>
<pre class="def">Box Type: 'sscl'  
Mandatory (per sample): No  
Quantity (per sample): Any  
Inputs: At most one
</pre>
    <p>The SampleScaling derivation transformation scales the input image to a
target size.</p>
    <p>The computation of the target size from the syntax elements is the same
as the one specified for ImageScaling as defined in <a data-link-type="biblio" href="#biblio-iso23008-12">[iso23008-12]</a></p>
    <h4 class="no-toc heading settled" data-level="9.6.2" id="scaling-syntax"><span class="secno">9.6.2. </span><span class="content">Syntax</span><a class="self-link" href="#scaling-syntax"></a></h4>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="samplescaling"><c- n>SampleScaling</c-><a class="self-link" href="#samplescaling"></a></dfn>  
<c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase⑦"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- n>sscl</c->'<c- p>,</c-> <c- n>flags</c-><c- p>)</c-> <c- p>{</c->  
  <c- b>unsigned</c-> <c- b>int</c-> <c- p>(</c-><c- mi>16</c-><c- p>)</c-> <c- n>target_width_numerator</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-> <c- p>(</c-><c- mi>16</c-><c- p>)</c-> <c- n>target_width_denominator</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-> <c- p>(</c-><c- mi>16</c-><c- p>)</c-> <c- n>target_height_numerator</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-> <c- p>(</c-><c- mi>16</c-><c- p>)</c-> <c- n>target_height_denominator</c-><c- p>;</c->  
<c- p>}</c->
</pre>
    <h4 class="no-toc heading settled" data-level="9.6.3" id="scaling-semantics"><span class="secno">9.6.3. </span><span class="content">Semantics</span><a class="self-link" href="#scaling-semantics"></a></h4>
    <p>The semantics of the syntax elements within the SampleScaling derivation
transformation are the same as those specified for the syntax elements
of ImageScaling as defined in <a data-link-type="biblio" href="#biblio-iso23008-12">[iso23008-12]</a>.</p>
    <h3 class="heading settled" data-level="9.7" id="roi"><span class="secno">9.7. </span><span class="content">Region of interest (ROI) selection</span><a class="self-link" href="#roi"></a></h3>
    <h4 class="no-toc heading settled" data-level="9.7.1" id="roi-definition"><span class="secno">9.7.1. </span><span class="content">Definition</span><a class="self-link" href="#roi-definition"></a></h4>
<pre class="def">Box Type: '2dcc'  
Mandatory (per sample): No  
Quantity (per sample): Any  
Inputs: [1] visual track, [2] ROI timed metadata track
</pre>
    <p>The number of input entities shall be equal to 2 for this transform
operation, and the input entities for this transform operation shall be
a visual track and a ROI timed metadata track as defined in <a data-link-type="biblio" href="#biblio-iso23001-10">[iso23001-10]</a>.</p>
    <p>The ROISelection derivation transformation uses the 2D Cartesian
coordinates track of the second track to crop the samples of the first
input track. In other words, the 2D Cartesian coordinates track is
applied prescriptively to the visual track that is the input entity for
the ROI selection transform operation. The output of the transformation
contains only the rectangle specified by the Cartesian coordinates
track.</p>
    <h4 class="no-toc heading settled" data-level="9.7.2" id="roi-syntax"><span class="secno">9.7.2. </span><span class="content">Syntax</span><a class="self-link" href="#roi-syntax"></a></h4>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="roiselection"><c- n>ROISelection</c-><a class="self-link" href="#roiselection"></a></dfn>  
<c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase⑧"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- mi>2</c-><c- n>dcc</c->'<c- p>,</c-> <c- n>flags</c-><c- p>)</c-> <c- p>{</c->  
<c- p>}</c->
</pre>
    <h3 class="heading settled" data-level="9.8" id="trackgrid"><span class="secno">9.8. </span><span class="content">Track Grid Composition</span><a class="self-link" href="#trackgrid"></a></h3>
    <h4 class="no-toc heading settled" data-level="9.8.1" id="trackgrid-definition"><span class="secno">9.8.1. </span><span class="content">Definition</span><a class="self-link" href="#trackgrid-definition"></a></h4>
<pre class="def">Box Type: 'tgcp'  
Mandatory (per sample): No  
Quantity (per sample): Any  
Inputs: Exactly rows*columns
</pre>
    <p>The TrackGridComposition derivation transformation provides a
composition of input images in a given grid order.</p>
    <p>The input images are inserted in row-major order, top-row first, left to
right, in the order they are listed as the derivation operation inputs.
The number of input images shall be equal to <code>rows*columns</code>. All input
images (possibly after being resized) shall have exactly the same width
and height, width and height. The input images, when composed together,
completely “cover” the output image of the transformation according to
the grid, where <code>width*columns</code> is equal to <code>output_width</code> and <code>height*rows</code> is equal to <code>output_height</code>. In other words, the output
image of the transformation is formed by tiling the input images into a
grid with a column width equal to width and a row height equal to
height, without any gap or overlap.</p>
    <h4 class="no-toc heading settled" data-level="9.8.2" id="trackgrid-syntax"><span class="secno">9.8.2. </span><span class="content">Syntax</span><a class="self-link" href="#trackgrid-syntax"></a></h4>
<pre class="sdl highlight"><c- n>aligned</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>class</c-> <dfn data-dfn-type="dfn" data-noexport id="trackgridcomposition"><c- n>TrackGridComposition</c-><a class="self-link" href="#trackgridcomposition"></a></dfn>  
<c- n>extends</c-> <a href="#visualderivationbase" id="ref-for-visualderivationbase⑨"><c- n>VisualDerivationBase</c-></a> <c- p>(</c->'<c- n>tgcp</c->'<c- p>,</c-> <c- n>flags</c-><c- p>)</c-> <c- p>{</c->  
  <c- b>unsigned</c-> <c- b>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>output_width</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>32</c-><c- p>)</c-> <c- n>output_height</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>rows_minus_one</c-><c- p>;</c->  
  <c- b>unsigned</c-> <c- nf>int</c-><c- p>(</c-><c- mi>8</c-><c- p>)</c-> <c- n>columns_minus_one</c-><c- p>;</c->  
<c- p>}</c->
</pre>
    <h4 class="no-toc heading settled" data-level="9.8.3" id="trackgrid-semantics"><span class="secno">9.8.3. </span><span class="content">Semantics</span><a class="self-link" href="#trackgrid-semantics"></a></h4>
    <ul>
     <li data-md>
      <p><code>output_width</code>, <code>output_height</code> specify the width and height, respectively, of the reconstructed output image on which the input images are placed.</p>
     <li data-md>
      <p><code>rows_minus_one</code>, <code>columns_minus_one</code> specify the number of rows of input images, and the number of input images per row; the value is one less than the number of rows or columns respectively. Input images populate the top row first, followed by the second and following, in the listing order of the derivation operation inputs.</p>
    </ul>
   </div>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#derivation-operation">derivation operation</a><span>, in §2.1</span>
   <li><a href="#derivation-transformation">derivation transformation</a><span>, in §2.2</span>
   <li><a href="#derived-sample">derived sample</a><span>, in §2.3</span>
   <li><a href="#derivedsample">DerivedSample</a><span>, in §6.2</span>
   <li><a href="#derivedvisualsampleentry">DerivedVisualSampleEntry</a><span>, in §5</span>
   <li><a href="#derived-visual-track">derived visual track</a><span>, in §2.4</span>
   <li><a href="#derivedvisualtrackconfigrecord">DerivedVisualTrackConfigRecord</a><span>, in §5.1.2</span>
   <li><a href="#dissolve">Dissolve</a><span>, in §9.2.2</span>
   <li><a href="#identity">Identity</a><span>, in §9.1.2</span>
   <li><a href="#roiselection">ROISelection</a><span>, in §9.7.2</span>
   <li><a href="#samplecrop">SampleCrop</a><span>, in §9.3.2</span>
   <li><a href="#samplemirror">SampleMirror</a><span>, in §9.5.2</span>
   <li><a href="#samplerotation">SampleRotation</a><span>, in §9.4.2</span>
   <li><a href="#samplescaling">SampleScaling</a><span>, in §9.6.2</span>
   <li><a href="#trackgridcomposition">TrackGridComposition</a><span>, in §9.8.2</span>
   <li><a href="#visualderivation">VisualDerivation</a><span>, in §4.2</span>
   <li><a href="#visualderivationbase">VisualDerivationBase</a><span>, in §4.2</span>
   <li><a href="#visualderivationdefault">VisualDerivationDefault</a><span>, in §5.1.2</span>
   <li><a href="#visualderivationinputs">VisualDerivationInputs</a><span>, in §4.2</span>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-iso14496-12">[ISO14496-12]
   <dd><a href="https://www.iso.org/standard/74428.html">Information technology — Coding of audio-visual objects — Part 12: ISO base media file format</a>. Under development. URL: <a href="https://www.iso.org/standard/74428.html">https://www.iso.org/standard/74428.html</a>
   <dt id="biblio-iso23001-10">[ISO23001-10]
   <dd><a href="https://www.iso.org/standard/78824.html">Information technology — MPEG systems technologies — Part 10: Carriage of timed metadata metrics of media in ISO base media file format</a>. April 2020. Published. URL: <a href="https://www.iso.org/standard/78824.html">https://www.iso.org/standard/78824.html</a>
   <dt id="biblio-iso23008-12">[ISO23008-12]
   <dd><a href="https://www.iso.org/standard/66067.html">Information technology — High efficiency coding and media delivery in heterogeneous environments — Part 12: Image File Format</a>. December 2017. Published. URL: <a href="https://www.iso.org/standard/66067.html">https://www.iso.org/standard/66067.html</a>
  </dl>
  <aside class="dfn-panel" data-for="derivation-operation">
   <b><a href="#derivation-operation">#derivation-operation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-derivation-operation">2.3. derived sample</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="derivation-transformation">
   <b><a href="#derivation-transformation">#derivation-transformation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-derivation-transformation">2.1. derivation operation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="derived-sample">
   <b><a href="#derived-sample">#derived-sample</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-derived-sample">2.4. derived visual track</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="visualderivationbase">
   <b><a href="#visualderivationbase">#visualderivationbase</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-visualderivationbase">7.2. Syntax</a> <a href="#ref-for-visualderivationbase">(2)</a>
    <li><a href="#ref-for-visualderivationbase">9.1.2. Syntax</a>
    <li><a href="#ref-for-visualderivationbase">9.2.2. Syntax</a>
    <li><a href="#ref-for-visualderivationbase">9.3.2. Syntax</a>
    <li><a href="#ref-for-visualderivationbase">9.4.2. Syntax</a>
    <li><a href="#ref-for-visualderivationbase">9.5.2. Syntax</a>
    <li><a href="#ref-for-visualderivationbase">9.6.2. Syntax</a>
    <li><a href="#ref-for-visualderivationbase">9.7.2. Syntax</a>
    <li><a href="#ref-for-visualderivationbase">9.8.2. Syntax</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>